module str-reader

imports
  strategodebuglib


imports
  libstrc
  libstratego-lib
  libstratego-sglr
  libstratego-xtc
  libstratego-gpp
  libstratego-aterm
  trans-str


strategies


rules


rules

  write-stratego(|absolute-location) =
    s-enter(
    | "str-reader.str"
    , "write-stratego"
    , LocationInfo("30", "3", "35", "72")
    )
    ; (where(<s-var(
              | "str-reader.str"
              , "write-stratego"
              , "absolute-location"
              , LocationInfo("30", "19", "30", "36")
              )> absolute-location)
       ; (<(s-step(
            | "str-reader.str"
            , "write-stratego"
            , LocationInfo("31", "5", "31", "15")
            )
            ; get-config)> "--output-rtree"
          < s-step(
            | "str-reader.str"
            , "write-stratego"
            , LocationInfo("33", "4", "33", "76")
            )
            ; write-stratego-rtree(
              | <s-step(
                 | "str-reader.str"
                 , "write-stratego"
                 , LocationInfo("33", "27", "33", "56")
                 )
                 ; guarantee-extension(|"rtree")> absolute-location
              )
          + s-step(
            | "str-reader.str"
            , "write-stratego"
            , LocationInfo("35", "4", "35", "72")
            )
            ; write-stratego-str(
              | <s-step(
                 | "str-reader.str"
                 , "write-stratego"
                 , LocationInfo("35", "25", "35", "52")
                 )
                 ; guarantee-extension(|"str")> absolute-location
              ))
       < s-exit(
         | "str-reader.str"
         , "write-stratego"
         , LocationInfo("30", "3", "35", "72")
         )
       + s-exit(
         | "str-reader.str"
         , "write-stratego"
         , LocationInfo("30", "3", "35", "72")
         )
         ; fail)

  write-stratego-rtree(|absolute-location) =
    s-enter(
    | "str-reader.str"
    , "write-stratego-rtree"
    , LocationInfo("39", "3", "44", "50")
    )
    ; (where(<s-var(
              | "str-reader.str"
              , "write-stratego-rtree"
              , "absolute-location"
              , LocationInfo("39", "25", "39", "42")
              )> absolute-location)
       ; (s-step(
          | "str-reader.str"
          , "write-stratego-rtree"
          , LocationInfo("40", "4", "40", "57")
          )
          ; where(<(s-step(
                    | "str-reader.str"
                    , "write-stratego-rtree"
                    , LocationInfo("40", "11", "40", "37")
                    )
                    ; debug(
                        s-step(
                        | "str-reader.str"
                        , "write-stratego-rtree"
                        , LocationInfo("40", "17", "40", "36")
                        )
                        ; !"Writing rtree..."
                      ))> absolute-location))
       ; (s-step(
          | "str-reader.str"
          , "write-stratego-rtree"
          , LocationInfo("41", "4", "41", "8")
          )
          ; ?ast)
       ; (s-step(
          | "str-reader.str"
          , "write-stratego-rtree"
          , LocationInfo("42", "6", "42", "40")
          )
          ; <(s-step(
              | "str-reader.str"
              , "write-stratego-rtree"
              , LocationInfo("42", "7", "42", "14")
              )
              ; dirname)> absolute-location => dir)
       ; <(s-step(
           | "str-reader.str"
           , "write-stratego-rtree"
           , LocationInfo("43", "8", "43", "17")
           )
           ; check-dir)> dir
       ; <(s-step(
           | "str-reader.str"
           , "write-stratego-rtree"
           , LocationInfo("44", "7", "44", "24")
           )
           ; WriteToBinaryFile)> (absolute-location, ast)
       < s-exit(
         | "str-reader.str"
         , "write-stratego-rtree"
         , LocationInfo("39", "3", "44", "50")
         )
       + s-exit(
         | "str-reader.str"
         , "write-stratego-rtree"
         , LocationInfo("39", "3", "44", "50")
         )
         ; fail)

  write-stratego-str(|absolute-location):
    ast -> <r-exit(
            | "str-reader.str"
            , "write-stratego-str"
            , LocationInfo("48", "3", "56", "53")
            )> absolute-location
    where r-enter(
          | "str-reader.str"
          , "write-stratego-str"
          , LocationInfo("48", "3", "56", "53")
          )
    where <s-var(
           | "str-reader.str"
           , "write-stratego-str"
           , "absolute-location"
           , LocationInfo("48", "23", "48", "40")
           )> absolute-location
    where <s-var(
           | "str-reader.str"
           , "write-stratego-str"
           , "ast"
           , LocationInfo("49", "4", "49", "7")
           )> ast
    where <(s-step(
            | "str-reader.str"
            , "write-stratego-str"
            , LocationInfo("50", "11", "50", "35")
            )
            ; debug(
                s-step(
                | "str-reader.str"
                , "write-stratego-str"
                , LocationInfo("50", "17", "50", "34")
                )
                ; !"Writing str..."
              ))> absolute-location
    where (s-step(
           | "str-reader.str"
           , "write-stratego-str"
           , LocationInfo("52", "5", "52", "41")
           )
           ; source-code := <s-step(
                             | "str-reader.str"
                             , "write-stratego-str"
                             , LocationInfo("52", "21", "52", "36")
                             )
                             ; pp-stratego-ast> ast
           ; <s-var(
              | "str-reader.str"
              , "write-stratego-str"
              , "source-code"
              , LocationInfo("52", "5", "52", "16")
              )> source-code)
          ; (s-step(
             | "str-reader.str"
             , "write-stratego-str"
             , LocationInfo("53", "7", "53", "41")
             )
             ; <(s-step(
                 | "str-reader.str"
                 , "write-stratego-str"
                 , LocationInfo("53", "8", "53", "15")
                 )
                 ; dirname)> absolute-location => dir)
          ; <(s-step(
              | "str-reader.str"
              , "write-stratego-str"
              , LocationInfo("55", "8", "55", "17")
              )
              ; check-dir)> dir
          ; s-step(
            | "str-reader.str"
            , "write-stratego-str"
            , LocationInfo("56", "7", "56", "53")
            )
          ; write-to-file(|absolute-location, source-code)


strategies
  write-files-relative(|base-dir):
    transform-results* -> <r-exit(
                           | "str-reader.str"
                           , "write-files-relative"
                           , LocationInfo("62", "3", "67", "78")
                           )> writes*
    where r-enter(
          | "str-reader.str"
          , "write-files-relative"
          , LocationInfo("62", "3", "67", "78")
          )
    where <s-var(
           | "str-reader.str"
           , "write-files-relative"
           , "base-dir"
           , LocationInfo("62", "25", "62", "33")
           )> base-dir
    where <s-var(
           | "str-reader.str"
           , "write-files-relative"
           , "transform-results*"
           , LocationInfo("63", "5", "63", "23")
           )> transform-results*
    with s-step(
         | "str-reader.str"
         , "write-files-relative"
         , LocationInfo("67", "8", "67", "78")
         )
         ; writes* := <s-step(
                       | "str-reader.str"
                       , "write-files-relative"
                       , LocationInfo("67", "20", "67", "58")
                       )
                       ; map(
                           s-step(
                           | "str-reader.str"
                           , "write-files-relative"
                           , LocationInfo("67", "24", "67", "57")
                           )
                           ; write-to-file-relative(|base-dir)
                         )> transform-results*
         ; <s-var(
            | "str-reader.str"
            , "write-files-relative"
            , "writes*"
            , LocationInfo("67", "8", "67", "15")
            )> writes*

  write-to-file-relative(|base-dir):
    (filename, content) -> <r-exit(
                            | "str-reader.str"
                            , "write-to-file-relative"
                            , LocationInfo("72", "3", "78", "43")
                            )> filename
    where r-enter(
          | "str-reader.str"
          , "write-to-file-relative"
          , LocationInfo("72", "3", "78", "43")
          )
    where <s-var(
           | "str-reader.str"
           , "write-to-file-relative"
           , "base-dir"
           , LocationInfo("72", "27", "72", "35")
           )> base-dir
    where <s-var(
           | "str-reader.str"
           , "write-to-file-relative"
           , "filename"
           , LocationInfo("73", "5", "73", "13")
           )> filename
          ; <s-var(
             | "str-reader.str"
             , "write-to-file-relative"
             , "content"
             , LocationInfo("73", "15", "73", "22")
             )> content
    where (s-step(
           | "str-reader.str"
           , "write-to-file-relative"
           , LocationInfo("75", "4", "75", "62")
           )
           ; <(s-step(
               | "str-reader.str"
               , "write-to-file-relative"
               , LocationInfo("75", "5", "75", "19")
               )
               ; concat-strings)> [base-dir, "/", filename] => absolutepath)
          ; (s-step(
             | "str-reader.str"
             , "write-to-file-relative"
             , LocationInfo("76", "6", "76", "35")
             )
             ; <(s-step(
                 | "str-reader.str"
                 , "write-to-file-relative"
                 , LocationInfo("76", "7", "76", "14")
                 )
                 ; dirname)> absolutepath => dir)
          ; (s-step(
             | "str-reader.str"
             , "write-to-file-relative"
             , LocationInfo("77", "6", "77", "15")
             )
             ; check-dir)
          ; s-step(
            | "str-reader.str"
            , "write-to-file-relative"
            , LocationInfo("78", "6", "78", "43")
            )
          ; write-to-file(|absolutepath, content)

  write-to-file(|filename, contents) =
    s-enter(
    | "str-reader.str"
    , "write-to-file"
    , LocationInfo("82", "2", "85", "11")
    )
    ; (where(<s-var(
              | "str-reader.str"
              , "write-to-file"
              , "filename"
              , LocationInfo("82", "17", "82", "25")
              )> filename
             ; <s-var(
                | "str-reader.str"
                , "write-to-file"
                , "contents"
                , LocationInfo("82", "27", "82", "35")
                )> contents)
       ; (s-step(
          | "str-reader.str"
          , "write-to-file"
          , LocationInfo("83", "3", "83", "36")
          )
          ; handle := <s-step(
                       | "str-reader.str"
                       , "write-to-file"
                       , LocationInfo("83", "14", "83", "19")
                       )
                       ; fopen> (filename, "w")
          ; <s-var(
             | "str-reader.str"
             , "write-to-file"
             , "handle"
             , LocationInfo("83", "3", "83", "9")
             )> handle)
       ; <(s-step(
           | "str-reader.str"
           , "write-to-file"
           , LocationInfo("84", "6", "84", "11")
           )
           ; fputs)> (contents, handle)
       ; s-step(
         | "str-reader.str"
         , "write-to-file"
         , LocationInfo("85", "5", "85", "11")
         )
       ; fclose
       < s-exit(
         | "str-reader.str"
         , "write-to-file"
         , LocationInfo("82", "2", "85", "11")
         )
       + s-exit(
         | "str-reader.str"
         , "write-to-file"
         , LocationInfo("82", "2", "85", "11")
         )
         ; fail)

  get-file-handle(|filename) =
    s-enter(
    | "str-reader.str"
    , "get-file-handle"
    , LocationInfo("93", "2", "94", "36")
    )
    ; (where(<s-var(
              | "str-reader.str"
              , "get-file-handle"
              , "filename"
              , LocationInfo("93", "19", "93", "27")
              )> filename)
       ; s-step(
         | "str-reader.str"
         , "get-file-handle"
         , LocationInfo("94", "3", "94", "36")
         )
       ; handle := <s-step(
                    | "str-reader.str"
                    , "get-file-handle"
                    , LocationInfo("94", "14", "94", "19")
                    )
                    ; fopen> (filename, "w")
       ; <s-var(
          | "str-reader.str"
          , "get-file-handle"
          , "handle"
          , LocationInfo("94", "3", "94", "9")
          )> handle
       < s-exit(
         | "str-reader.str"
         , "get-file-handle"
         , LocationInfo("93", "2", "94", "36")
         )
       + s-exit(
         | "str-reader.str"
         , "get-file-handle"
         , LocationInfo("93", "2", "94", "36")
         )
         ; fail)

  write-contents-to-handle(|file-handle, contents) =
    s-enter(
    | "str-reader.str"
    , "write-contents-to-handle"
    , LocationInfo("99", "2", "99", "85")
    )
    ; (where(<s-var(
              | "str-reader.str"
              , "write-contents-to-handle"
              , "file-handle"
              , LocationInfo("99", "28", "99", "39")
              )> file-handle
             ; <s-var(
                | "str-reader.str"
                , "write-contents-to-handle"
                , "contents"
                , LocationInfo("99", "41", "99", "49")
                )> contents)
       ; <(s-step(
           | "str-reader.str"
           , "write-contents-to-handle"
           , LocationInfo("99", "55", "99", "60")
           )
           ; fputs)> (contents, file-handle)
       < s-exit(
         | "str-reader.str"
         , "write-contents-to-handle"
         , LocationInfo("99", "2", "99", "85")
         )
       + s-exit(
         | "str-reader.str"
         , "write-contents-to-handle"
         , LocationInfo("99", "2", "99", "85")
         )
         ; fail)

  close-file-handle(|file-handle) =
    s-enter(
    | "str-reader.str"
    , "close-file-handle"
    , LocationInfo("102", "2", "102", "56")
    )
    ; (where(<s-var(
              | "str-reader.str"
              , "close-file-handle"
              , "file-handle"
              , LocationInfo("102", "21", "102", "32")
              )> file-handle)
       ; <(s-step(
           | "str-reader.str"
           , "close-file-handle"
           , LocationInfo("102", "37", "102", "43")
           )
           ; fclose)> file-handle
       < s-exit(
         | "str-reader.str"
         , "close-file-handle"
         , LocationInfo("102", "2", "102", "56")
         )
       + s-exit(
         | "str-reader.str"
         , "close-file-handle"
         , LocationInfo("102", "2", "102", "56")
         )
         ; fail)

  check-dir =
    s-enter(
    | "str-reader.str"
    , "check-dir"
    , LocationInfo("106", "2", "112", "20")
    )
    ; (((s-step(
         | "str-reader.str"
         , "check-dir"
         , LocationInfo("107", "3", "107", "13")
         )
         ; ?directory)
        ; (s-step(
           | "str-reader.str"
           , "check-dir"
           , LocationInfo("109", "5", "109", "38")
           )
           ; parent-dir := <s-step(
                            | "str-reader.str"
                            , "check-dir"
                            , LocationInfo("109", "20", "109", "27")
                            )
                            ; dirname> directory
           ; <s-var(
              | "str-reader.str"
              , "check-dir"
              , "parent-dir"
              , LocationInfo("109", "5", "109", "15")
              )> parent-dir)
        ; (s-step(
           | "str-reader.str"
           , "check-dir"
           , LocationInfo("110", "5", "110", "15")
           )
           ; !directory)
        ; (s-step(
           | "str-reader.str"
           , "check-dir"
           , LocationInfo("111", "6", "111", "17")
           )
           ; file-exists)
        ; (s-step(
           | "str-reader.str"
           , "check-dir"
           , LocationInfo("111", "20", "111", "28")
           )
           ; filemode)
        ; s-step(
          | "str-reader.str"
          , "check-dir"
          , LocationInfo("111", "31", "111", "36")
          )
        ; isdir
        <+ s-step(
           | "str-reader.str"
           , "check-dir"
           , LocationInfo("112", "9", "112", "19")
           )
           ; create-dir)
       < s-exit(
         | "str-reader.str"
         , "check-dir"
         , LocationInfo("106", "2", "112", "20")
         )
       + s-exit(
         | "str-reader.str"
         , "check-dir"
         , LocationInfo("106", "2", "112", "20")
         )
         ; fail)

  create-dir =
    s-enter(
    | "str-reader.str"
    , "create-dir"
    , LocationInfo("116", "2", "123", "6")
    )
    ; ((s-step(
        | "str-reader.str"
        , "create-dir"
        , LocationInfo("117", "3", "117", "13")
        )
        ; ?directory)
       ; (s-step(
          | "str-reader.str"
          , "create-dir"
          , LocationInfo("119", "5", "119", "38")
          )
          ; parent-dir := <s-step(
                           | "str-reader.str"
                           , "create-dir"
                           , LocationInfo("119", "20", "119", "27")
                           )
                           ; dirname> directory
          ; <s-var(
             | "str-reader.str"
             , "create-dir"
             , "parent-dir"
             , LocationInfo("119", "5", "119", "15")
             )> parent-dir)
       ; <(s-step(
           | "str-reader.str"
           , "create-dir"
           , LocationInfo("120", "6", "120", "15")
           )
           ; check-dir)> parent-dir
       ; s-step(
         | "str-reader.str"
         , "create-dir"
         , LocationInfo("122", "5", "123", "6")
         )
       ; try(
           (s-step(
            | "str-reader.str"
            , "create-dir"
            , LocationInfo("122", "9", "122", "19")
            )
            ; !directory)
           ; s-step(
             | "str-reader.str"
             , "create-dir"
             , LocationInfo("122", "21", "122", "26")
             )
           ; mkdir
         )
       < s-exit(
         | "str-reader.str"
         , "create-dir"
         , LocationInfo("116", "2", "123", "6")
         )
       + s-exit(
         | "str-reader.str"
         , "create-dir"
         , LocationInfo("116", "2", "123", "6")
         )
         ; fail)

  pp-stratego-ast =
    s-enter(
    | "str-reader.str"
    , "pp-stratego-ast"
    , LocationInfo("127", "3", "128", "22")
    )
    ; (s-step(
       | "str-reader.str"
       , "pp-stratego-ast"
       , LocationInfo("128", "4", "128", "22")
       )
       ; pp-stratego-string
       < s-exit(
         | "str-reader.str"
         , "pp-stratego-ast"
         , LocationInfo("127", "3", "128", "22")
         )
       + s-exit(
         | "str-reader.str"
         , "pp-stratego-ast"
         , LocationInfo("127", "3", "128", "22")
         )
         ; fail)


strategies
  parse-stratego-with-locations(|file-path) =
    s-enter(
    | "str-reader.str"
    , "parse-stratego-with-locations"
    , LocationInfo("135", "3", "147", "7")
    )
    ; (where(<s-var(
              | "str-reader.str"
              , "parse-stratego-with-locations"
              , "file-path"
              , LocationInfo("135", "34", "135", "43")
              )> file-path)
       ; (s-step(
          | "str-reader.str"
          , "parse-stratego-with-locations"
          , LocationInfo("136", "2", "136", "18")
          )
          ; !FILE(file-path))
       ; s-step(
         | "str-reader.str"
         , "parse-stratego-with-locations"
         , LocationInfo("137", "4", "147", "7")
         )
       ; parse-stratego-trm(
         | [ "-i"
           , file-path
           , "--preserve-locations"
           , "-I"
           , <s-step(
              | "str-reader.str"
              , "parse-stratego-with-locations"
              , LocationInfo("139", "13", "139", "30")
              )
              ; stratego-box-path>
           , "-I"
           , <s-step(
              | "str-reader.str"
              , "parse-stratego-with-locations"
              , LocationInfo("140", "13", "140", "31")
              )
              ; stratego-sdf2-path>
           , "-I"
           , <s-step(
              | "str-reader.str"
              , "parse-stratego-with-locations"
              , LocationInfo("141", "13", "141", "35")
              )
              ; stratego-stratego-path>
           , "-I"
           , <s-step(
              | "str-reader.str"
              , "parse-stratego-with-locations"
              , LocationInfo("142", "13", "142", "28")
              )
              ; stratego-c-path>
           , "-I"
           , <s-step(
              | "str-reader.str"
              , "parse-stratego-with-locations"
              , LocationInfo("143", "13", "143", "30")
              )
              ; stratego-xml-path>
           , "-I"
           , <s-step(
              | "str-reader.str"
              , "parse-stratego-with-locations"
              , LocationInfo("144", "13", "144", "30")
              )
              ; stratego-rtg-path>
           , "-I"
           , <s-step(
              | "str-reader.str"
              , "parse-stratego-with-locations"
              , LocationInfo("145", "13", "145", "39")
              )
              ; stratego-propstratego-path>
           ]
         )
       < s-exit(
         | "str-reader.str"
         , "parse-stratego-with-locations"
         , LocationInfo("135", "3", "147", "7")
         )
       + s-exit(
         | "str-reader.str"
         , "parse-stratego-with-locations"
         , LocationInfo("135", "3", "147", "7")
         )
         ; fail)

  stratego-box-path =
    s-enter(
    | "str-reader.str"
    , "stratego-box-path"
    , LocationInfo("161", "3", "161", "69")
    )
    ; (s-step(
       | "str-reader.str"
       , "stratego-box-path"
       , LocationInfo("161", "23", "161", "69")
       )
       ; !"/home/rlindeman/.nix-profile/share/sdf/gpp/"
       < s-exit(
         | "str-reader.str"
         , "stratego-box-path"
         , LocationInfo("161", "3", "161", "69")
         )
       + s-exit(
         | "str-reader.str"
         , "stratego-box-path"
         , LocationInfo("161", "3", "161", "69")
         )
         ; fail)

  stratego-sdf2-path =
    s-enter(
    | "str-reader.str"
    , "stratego-sdf2-path"
    , LocationInfo("177", "3", "177", "76")
    )
    ; (s-step(
       | "str-reader.str"
       , "stratego-sdf2-path"
       , LocationInfo("177", "24", "177", "76")
       )
       ; !"/home/rlindeman/.nix-profile/share/sdf/sdf-front/"
       < s-exit(
         | "str-reader.str"
         , "stratego-sdf2-path"
         , LocationInfo("177", "3", "177", "76")
         )
       + s-exit(
         | "str-reader.str"
         , "stratego-sdf2-path"
         , LocationInfo("177", "3", "177", "76")
         )
         ; fail)

  stratego-stratego-path =
    s-enter(
    | "str-reader.str"
    , "stratego-stratego-path"
    , LocationInfo("191", "3", "191", "85")
    )
    ; (s-step(
       | "str-reader.str"
       , "stratego-stratego-path"
       , LocationInfo("191", "28", "191", "85")
       )
       ; !"/home/rlindeman/.nix-profile/share/sdf/stratego-front/"
       < s-exit(
         | "str-reader.str"
         , "stratego-stratego-path"
         , LocationInfo("191", "3", "191", "85")
         )
       + s-exit(
         | "str-reader.str"
         , "stratego-stratego-path"
         , LocationInfo("191", "3", "191", "85")
         )
         ; fail)

  stratego-c-path =
    s-enter(
    | "str-reader.str"
    , "stratego-c-path"
    , LocationInfo("214", "3", "214", "70")
    )
    ; (s-step(
       | "str-reader.str"
       , "stratego-c-path"
       , LocationInfo("214", "21", "214", "70")
       )
       ; !"/home/rlindeman/.nix-profile/share/sdf/c-tools"
       < s-exit(
         | "str-reader.str"
         , "stratego-c-path"
         , LocationInfo("214", "3", "214", "70")
         )
       + s-exit(
         | "str-reader.str"
         , "stratego-c-path"
         , LocationInfo("214", "3", "214", "70")
         )
         ; fail)

  stratego-xml-path =
    s-enter(
    | "str-reader.str"
    , "stratego-xml-path"
    , LocationInfo("228", "3", "228", "74")
    )
    ; (s-step(
       | "str-reader.str"
       , "stratego-xml-path"
       , LocationInfo("228", "23", "228", "74")
       )
       ; !"/home/rlindeman/.nix-profile/share/sdf/xml-front"
       < s-exit(
         | "str-reader.str"
         , "stratego-xml-path"
         , LocationInfo("228", "3", "228", "74")
         )
       + s-exit(
         | "str-reader.str"
         , "stratego-xml-path"
         , LocationInfo("228", "3", "228", "74")
         )
         ; fail)

  stratego-rtg-path =
    s-enter(
    | "str-reader.str"
    , "stratego-rtg-path"
    , LocationInfo("243", "3", "243", "81")
    )
    ; (s-step(
       | "str-reader.str"
       , "stratego-rtg-path"
       , LocationInfo("243", "23", "243", "81")
       )
       ; !"/home/rlindeman/.nix-profile/share/sdf/stratego-regular"
       < s-exit(
         | "str-reader.str"
         , "stratego-rtg-path"
         , LocationInfo("243", "3", "243", "81")
         )
       + s-exit(
         | "str-reader.str"
         , "stratego-rtg-path"
         , LocationInfo("243", "3", "243", "81")
         )
         ; fail)

  stratego-propstratego-path =
    s-enter(
    | "str-reader.str"
    , "stratego-propstratego-path"
    , LocationInfo("251", "3", "251", "105")
    )
    ; (s-step(
       | "str-reader.str"
       , "stratego-propstratego-path"
       , LocationInfo("251", "32", "251", "105")
       )
       ; !"/home/rlindeman/Documents/TU/strategoxt/strategoxt/stratego-front/test"
       < s-exit(
         | "str-reader.str"
         , "stratego-propstratego-path"
         , LocationInfo("251", "3", "251", "105")
         )
       + s-exit(
         | "str-reader.str"
         , "stratego-propstratego-path"
         , LocationInfo("251", "3", "251", "105")
         )
         ; fail)


strategies
  is-stratego-file =
    s-enter(
    | "str-reader.str"
    , "is-stratego-file"
    , LocationInfo("279", "2", "279", "77")
    )
    ; ((s-step(
        | "str-reader.str"
        , "is-stratego-file"
        , LocationInfo("279", "21", "279", "42")
        )
        ; has-extension(|"str"))
       ; (s-step(
          | "str-reader.str"
          , "is-stratego-file"
          , LocationInfo("279", "44", "279", "55")
          )
          ; file-exists)
       ; (s-step(
          | "str-reader.str"
          , "is-stratego-file"
          , LocationInfo("279", "57", "279", "65")
          )
          ; filemode)
       ; s-step(
         | "str-reader.str"
         , "is-stratego-file"
         , LocationInfo("279", "67", "279", "77")
         )
       ; not(s-step(
             | "str-reader.str"
             , "is-stratego-file"
             , LocationInfo("279", "71", "279", "76")
             )
             ; isdir)
       < s-exit(
         | "str-reader.str"
         , "is-stratego-file"
         , LocationInfo("279", "2", "279", "77")
         )
       + s-exit(
         | "str-reader.str"
         , "is-stratego-file"
         , LocationInfo("279", "2", "279", "77")
         )
         ; fail)

  walk-dir(s) =
    s-enter(
    | "str-reader.str"
    , "walk-dir"
    , LocationInfo("287", "2", "297", "47")
    )
    ; ((s-step(
        | "str-reader.str"
        , "walk-dir"
        , LocationInfo("288", "3", "288", "12")
        )
        ; ?base-dir)
       ; (s-step(
          | "str-reader.str"
          , "walk-dir"
          , LocationInfo("289", "5", "289", "12")
          )
          ; readdir)
       ; (s-step(
          | "str-reader.str"
          , "walk-dir"
          , LocationInfo("290", "5", "290", "48")
          )
          ; fullpaths* := <s-step(
                           | "str-reader.str"
                           , "walk-dir"
                           , LocationInfo("290", "20", "290", "47")
                           )
                           ; map(
                               s-step(
                               | "str-reader.str"
                               , "walk-dir"
                               , LocationInfo("290", "24", "290", "46")
                               )
                               ; prefix-with(|base-dir)
                             )>
          ; <s-var(
             | "str-reader.str"
             , "walk-dir"
             , "fullpaths*"
             , LocationInfo("290", "5", "290", "15")
             )> fullpaths*)
       ; (s-step(
          | "str-reader.str"
          , "walk-dir"
          , LocationInfo("292", "5", "292", "28")
          )
          ; has-str* := <s-step(
                         | "str-reader.str"
                         , "walk-dir"
                         , LocationInfo("292", "18", "292", "27")
                         )
                         ; filter(
                             s-step(
                             | "str-reader.str"
                             , "walk-dir"
                             , LocationInfo("292", "25", "292", "26")
                             )
                             ; s
                           )>
          ; <s-var(
             | "str-reader.str"
             , "walk-dir"
             , "has-str*"
             , LocationInfo("292", "5", "292", "13")
             )> has-str*)
       ; (s-step(
          | "str-reader.str"
          , "walk-dir"
          , LocationInfo("294", "5", "294", "43")
          )
          ; dirs-only* := <s-step(
                           | "str-reader.str"
                           , "walk-dir"
                           , LocationInfo("294", "20", "294", "31")
                           )
                           ; filter-dirs> fullpaths*
          ; <s-var(
             | "str-reader.str"
             , "walk-dir"
             , "dirs-only*"
             , LocationInfo("294", "5", "294", "15")
             )> dirs-only*)
       ; (s-step(
          | "str-reader.str"
          , "walk-dir"
          , LocationInfo("295", "5", "295", "68")
          )
          ; str-in-subdirs* := <(s-step(
                                 | "str-reader.str"
                                 , "walk-dir"
                                 , LocationInfo("295", "25", "295", "41")
                                 )
                                 ; map(
                                     s-step(
                                     | "str-reader.str"
                                     , "walk-dir"
                                     , LocationInfo("295", "29", "295", "40")
                                     )
                                     ; walk-dir(
                                         s-step(
                                         | "str-reader.str"
                                         , "walk-dir"
                                         , LocationInfo("295", "38", "295", "39")
                                         )
                                         ; s
                                       )
                                   ))
                                ; s-step(
                                  | "str-reader.str"
                                  , "walk-dir"
                                  , LocationInfo("295", "44", "295", "56")
                                  )
                                ; flatten-list> dirs-only*
          ; <s-var(
             | "str-reader.str"
             , "walk-dir"
             , "str-in-subdirs*"
             , LocationInfo("295", "5", "295", "20")
             )> str-in-subdirs*)
       ; <(s-step(
           | "str-reader.str"
           , "walk-dir"
           , LocationInfo("297", "6", "297", "18")
           )
           ; flatten-list)> [str-in-subdirs*, has-str*]
       < s-exit(
         | "str-reader.str"
         , "walk-dir"
         , LocationInfo("287", "2", "297", "47")
         )
       + s-exit(
         | "str-reader.str"
         , "walk-dir"
         , LocationInfo("287", "2", "297", "47")
         )
         ; fail)

  prefix-with(|prefix):
    filename -> <r-exit(
                 | "str-reader.str"
                 , "prefix-with"
                 , LocationInfo("301", "2", "304", "52")
                 )> path
    where r-enter(
          | "str-reader.str"
          , "prefix-with"
          , LocationInfo("301", "2", "304", "52")
          )
    where <s-var(
           | "str-reader.str"
           , "prefix-with"
           , "prefix"
           , LocationInfo("301", "15", "301", "21")
           )> prefix
    where <s-var(
           | "str-reader.str"
           , "prefix-with"
           , "filename"
           , LocationInfo("302", "3", "302", "11")
           )> filename
    with s-step(
         | "str-reader.str"
         , "prefix-with"
         , LocationInfo("304", "4", "304", "52")
         )
         ; path := <s-step(
                    | "str-reader.str"
                    , "prefix-with"
                    , LocationInfo("304", "13", "304", "27")
                    )
                    ; concat-strings> [prefix, "/", filename]
         ; <s-var(
            | "str-reader.str"
            , "prefix-with"
            , "path"
            , LocationInfo("304", "4", "304", "8")
            )> path

  filter-dirs :
    paths* -> <r-exit(
               | "str-reader.str"
               , "filter-dirs"
               , LocationInfo("307", "2", "310", "60")
               )> dirs*
    where r-enter(
          | "str-reader.str"
          , "filter-dirs"
          , LocationInfo("307", "2", "310", "60")
          )
    where <s-var(
           | "str-reader.str"
           , "filter-dirs"
           , "paths*"
           , LocationInfo("308", "3", "308", "9")
           )> paths*
    with s-step(
         | "str-reader.str"
         , "filter-dirs"
         , LocationInfo("310", "4", "310", "60")
         )
         ; dirs* := <s-step(
                     | "str-reader.str"
                     , "filter-dirs"
                     , LocationInfo("310", "14", "310", "52")
                     )
                     ; filter(
                         (s-step(
                          | "str-reader.str"
                          , "filter-dirs"
                          , LocationInfo("310", "21", "310", "32")
                          )
                          ; file-exists)
                         ; (s-step(
                            | "str-reader.str"
                            , "filter-dirs"
                            , LocationInfo("310", "35", "310", "43")
                            )
                            ; filemode)
                         ; s-step(
                           | "str-reader.str"
                           , "filter-dirs"
                           , LocationInfo("310", "46", "310", "51")
                           )
                         ; isdir
                       )> paths*
         ; <s-var(
            | "str-reader.str"
            , "filter-dirs"
            , "dirs*"
            , LocationInfo("310", "4", "310", "9")
            )> dirs*